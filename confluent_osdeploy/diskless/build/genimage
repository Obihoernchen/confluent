installroot=$1

touch $installroot/.testcap
if setcap cap_net_raw+p $installroot/.testcap >& /dev/null; then
    capsargs=""
else
    capsargs="--setopt=tsflags=nocapps"
fi
rm $installroot/.testcap
yum  $capsargs --releasever=8  --installroot=/var/tmp/testgenimage/ --releasever=8.3 install '@minimal-environment' chrony kernel net-tools nfs-utils openssh-server rsync tar util-linux python3 tar dracut dracut-network ethtool parted openssl dhclient openssh-clients bash vim-minimal rpm iputils shim-x64 grub2-efi-x64
dracut -v --xz -N -m "stateless base terminfo" -f boot/initramfs-diskless 4.18.0-240.22.1.el8_3.x86_64
# link kernel, initrd, grub, and shim as appropriate

# use xz, minimize https burden and transfer penalty
mksquashfs -comp xz
